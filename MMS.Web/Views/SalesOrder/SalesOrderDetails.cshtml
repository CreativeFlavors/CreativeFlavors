@model MMS.Web.Models.Salesorders
@using MMS.Repository.Managers

<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="~/Content/css1/bootstrap.min.css" rel="stylesheet" />
    <link href="~/Content/css1/custom.css" rel="stylesheet" />
    <link href="~/Content/css1/responsive.css" rel="stylesheet" />
    <link href="~/Content/css1/variables.css" rel="stylesheet" />

    <style>
        table, th, td {
            border: 1px solid #C9C9C9;
            border-collapse: collapse;
            text-align: center;
        }

        td {
            padding: 1px;
        }

        th {
            padding: 22px 25px;
            font-size: 14px;
            font-family: 'Poppins';
            color: #292b2c;
        }

        .salesOrder td input {
            border: navajowhite;
            width: 100px;
            text-align: center;
        }

        .salesOrder {
            margin-left: 11px;
            margin-top: 7%;
        }

        div#billingadd {
            margin-top: -8%;
        }

        .form-group.col-3.mt-4 {
            margin-left: 9px;
        }

        p#Grandtotal {
            padding: 15%;
        }

        .alert {
            position: relative;
            padding: 5px 1rem;
        }

        .alert-danger {
            color: #842029;
            background-color: #f8d7da;
            border-color: #f5c2c7;
            width: 118%;
        }

        strong#close {
            margin-left: 16%;
            cursor: pointer;
        }

        #alert {
            margin-left: 24%;
        }
    </style>
</head>

<body>
    <div class="main-page">
        <section class="inner-section">
            <div class="edit-customer">
                <a href="/SalesOrder/SalesOrderMaster">
                    <div class="back-button"><img src="~/Content/assets/images/choose-plan.png" alt="back arrow"></div>
                </a>
                <h2 class=" font-20">New Sales Order</h2>
            </div>

            <div class="edit-section">
                <div class="d-flex justify-content-start">
                    <h3 class="font-20">Order Information</h3>
                    <div id="alert">

                    </div>
                </div>

                <div class="row">
                    <div class="col-lg-4 col-md-6 col-sm-12">
                        <div class="input-part">
                            <label class="font-14" for="#BuyerName">Buyer Name</label>
                            <select id="BuyerName" class="sel-dropdown" data-option="hidden">
                                @foreach (var item in MMS.Web.ExtensionMethod.HtmlHelper.BuyerName())
                                {
                                    <option value="@item.Value">@item.Text</option>
                                }
                            </select>
                        </div>
                    </div>
                    <div class="col-lg-4 col-md-6 col-sm-12">
                        <div class="input-part">
                            <label class="font-14" for="#ProductName">List Of Purchase item</label>
                            <select id="ProductName" class="sel-dropdown" data-option="hidden">
                                @foreach (var item in MMS.Web.ExtensionMethod.HtmlHelper.ProductName())
                                {
                                    <option value="@item.Value">@item.Text</option>
                                }
                            </select>
                        </div>
                    </div>
                    @*<div class="col-lg-4 col-md-6 col-sm-12">
                            <div class="input-part">
                                <label class="font-14" for="#Name">Quote Date Quote Ref No</label>
                                <input class="font-15" type="text" name="email" id="Name">
                            </div>
                        </div>*@

                    @*<div class="col-lg-4 col-md-6 col-sm-12">
                            <div class="input-part">
                                <label class="font-14" for="#ProductName">List Of Purchase item</label>
                                <select id="ProductName" class="sel-dropdown" data-option="hidden">
                                    @foreach (var item in MMS.Web.ExtensionMethod.HtmlHelper.ProductName())
                                    {
                                    <option value="@item.Value">@item.Text</option>
                                    }
                                </select>
                            </div>
                        </div>*@
                </div>
                @*<div class="row">
                        <div class="col-lg-4 col-md-6 col-sm-12">
                            <div class="input-part">
                                <label class="font-14" for="#ProductName">Discount Percentage</label>
                                <select id="ProductNacme" class="sel-dropdown" data-option="hidden">
                                    @foreach (var item in MMS.Web.ExtensionMethod.HtmlHelper.BuyerName())
                                    {
                                    <option value="@item.Value">@item.Text</option>
                                    }
                                </select>
                            </div>
                        </div>

                    </div>*@
                <table style="width:100%" class="salesOrder">
                    <thead>
                        <tr>
                            <th>Product Name</th>
                            <th>Product Code</th>
                            <th>Qty</th>
                            <th>UOM</th>
                            <th>Unit Price</th>
                            <th>Disc %</th>
                            <th>Discount Amount</th>
                            <th>Sub Total</th>
                            <th>Tax Rate</th>
                            <th>Tax Amount</th>
                            <th>Total Price</th>
                            <th>Additional Comments</th>
                            
                        </tr>
                    </thead>
                    <tbody>
                    </tbody>
                    <tr>
                        <td style="background-color: #e9ecef" id="productname"></td>
                        <td style="background-color: #e9ecef" id="productcode"></td>
                        <td>@Html.TextBoxFor(m => m.quantity, new { @class = "form-control" })</td>
                        <td style="background-color: #e9ecef" id="uomtype"></td>
                        <td style="background-color: #e9ecef" id="Price1"></td>
                        <td>@Html.TextBoxFor(m => m.discountperid, new { @class = "form-control" })</td>
                        <td style="background-color: #e9ecef" id="docdiscountvalue1"></td>
                        <td style="background-color: #e9ecef" id="subtotal1"></td>
                        <td style="background-color: #e9ecef" id="taxper"></td>
                        <td style="background-color: #e9ecef" id="TaxValue1"></td>
                        <td style="background-color: #e9ecef" id="Grandtotal1"></td>
                        <td style="background-color: #e9ecef">
                            <button class="btn btn-secondary" id="clickhere">Click Here</button>
                        </td>
                    </tr>

                </table>
                <div class="d-flex justify-content-between">

                    <div class="form-group col-3 mt-4">
                        <label for="exampleFormControlTextarea1">Comments or Special Instructions</label>
                        @Html.TextAreaFor(m => m.Specialinstruction, new { @class = "form-control mt-2", rows = "3", placeholder = "Comments ....." })
                    </div>
                    <div class="form-group col-3 mt-4" id="additional">
                        <label for="additionalcommends">Additional Comments</label>
                        @Html.TextAreaFor(m => m.Additionalcommends, new { @class = "form-control mt-2", rows = "3", placeholder = "Additional Comments ....." })
                    </div>
                    <div class="mt-4 form-group col-3">
                        <div class="form-group row mt-4">
                            <label for="inputEmail3" class="col-sm-4 col-form-label">Total</label>
                            <div class="col-sm-6">
                                @Html.TextBoxFor(m => m.Price, new { @class = "form-control", disabled = "disabled" })
                            </div>
                        </div>
                        <div class="form-group row mt-3">
                            <label for="inputEmail3" class="col-sm-4 col-form-label">Discount</label>
                            <div class="col-sm-6">
                                @Html.TextBoxFor(m => m.discountvalue, new { @class = "form-control", disabled = "disabled" })
                            </div>
                        </div>
                        <div class="form-group row mt-3">
                            <label for="subtotal" class="col-sm-4 col-form-label">Sub Total</label>
                            <div class="col-sm-6">
                                @Html.TextBoxFor(m => m.Subtotal, new { @class = "form-control", disabled = "disabled" })
                            </div>
                        </div>
                        <div class="form-group row mt-3">
                            <label for="inputEmail3" class="col-sm-4 col-form-label">Total Tax</label>
                            <div class="col-sm-6">
                                @Html.TextBoxFor(m => m.TaxValue, new { @class = "form-control", disabled = "disabled", id = "TaxValue" })
                            </div>
                        </div>
                        <div class="form-group row mt-3">
                            <label for="inputEmail3" class="col-sm-4 col-form-label">Grand Total</label>
                            <div class="col-sm-6">
                                @Html.TextBoxFor(m => m.Grandtotal, new { @class = "form-control", disabled = "disabled", id = "Grandtotal" })
                            </div>
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-lg-2 col-md-6 col-sm-12" id="billingadd">
                        <div class="input-part">
                            <h5 class="light-text">Billing-address</h5>
                            <ul>
                                <li id="libilingadd1"></li>
                                <li id="libilingadd2"></li>
                                <li id="libilingadd3"></li>
                                <li id="libilingadd4"></li>
                            </ul>
                        </div>
                    </div>
                    <div class="col-lg-2 col-md-6 col-sm-12" id="billingadd">
                        <div class="input-part">
                            <h5 class="light-text">Address</h5>
                            <ul>
                                <li id="libilingad1"></li>
                                <li id="libilingad2"></li>
                                <li id="libilingad3"></li>
                                <li id="libilingad4"></li>
                            </ul>
                        </div>
                    </div>
                </div>
                <div class="inner-section-button">
                    <button class="fill-color font-15" onclick="Save()">
                        SAVE
                    </button>
                    </a>
                    <a href="/SalesOrder/SalesOrderMaster">
                        <button class="border-color font-15">
                            CANCEL
                        </button>
                    </a>
                </div>
            </div>
        </section>
    </div>


    <!-- page-contents end -->
    <script src="~/Content/js/custom.js"></script>

    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@9"></script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js" integrity="sha512-894YE6QWD5I59HgZOGReFYm4dnWc1Qt5NtvYSaNcOP+u1T9qYdvdihz0PPSiiqn/+/3e7Jo4EaG7TubfWGUrMQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>

    <script src="~/Content/js/bootstrap.bundle.min.js"></script>

    <script>
        $(document).ready(function () {
            $("#additional").hide();
            $("#clickhere").click(function () {
                $("#additional").show();
            });


            $("#ProductName").change(function () {
                var buyerid = $('#ProductName').val();
                if (buyerid != "") {
                    $(".alert-danger").hide();
                    $.ajax({
                        url: '/SalesOrder/ProductidDetail',
                        type: "GET",
                        dataType: "JSON",
                        data: { id: buyerid },
                        success: function (Values) {
                            $("#subtotal").val("");
                            $("#subtotal1").text("");
                            $("#TaxValue").val("");
                            $("#TaxValue1").text("");
                            $("#Grandtotal").val("");
                            $("#Grandtotal1").text("");
                            $("#discountvalue").val("");
                            $("#docdiscountvalue1").text("");
                            $("#productname").text(Values.ProductName);
                            $("#productcode").text(Values.ProductCode);
                            $("#Price").val(Values.Price);
                            $("#Price1").text(Values.Price);
                            $("#uomtype").text(Values.UomMaster.LongUnitName);
                            $("#taxper").text(Values.TaxTypeMaster.TaxValue);

                            $("#quantity").keyup(function () {
                                var Qtyval = $('#quantity').val();
                                var price = Values.Price;
                                var taxper = Values.TaxTypeMaster.TaxValue;
                                if (Qtyval != "") {
                                    var subtotal = Qtyval * price;
                                    var taxamount = subtotal * taxper / 100;
                                    var totalcost = taxamount + subtotal;
                                    $("#subtotal1").text(subtotal);
                                    $("#Subtotal").val(subtotal);
                                    $("#TaxValue").val(taxamount);
                                    $("#TaxValue1").text(taxamount);
                                    $("#Grandtotal").val(totalcost);
                                    $("#Grandtotal1").text(totalcost);
                                }
                                else {
                                    $("#subtotal").val("");
                                    $("#subtotal1").text("");
                                    $("#TaxValue").val("");
                                    $("#TaxValue1").text("");
                                    $("#Grandtotal1").text("");
                                    $("#Grandtotal").val("");
                                }

                            });
                            $("#discountperid").keyup(function () {
                                var Qtyval = $('#quantity').val();
                                var discount = $('#discountperid').val();
                                var price = Values.Price;
                                var subtotal = Qtyval * price;
                                var taxper = Values.TaxTypeMaster.TaxValue;
                                if (discount != "") {
                                    $("#subtotal1").text("");
                                    $("#Subtotal").val("");
                                    $("#TaxValue1").text("");
                                    $("#TaxValue").val("");
                                    $("#Grandtotal").val("");
                                    $("#Grandtotal1").text("");
                                    var disamount = subtotal * discount / 100;
                                    var subtotals = subtotal - disamount;
                                    var taxamount = subtotals * taxper / 100;
                                    var total = taxamount + subtotals
                                    $("#docdiscountvalue1").text(disamount);
                                    $("#discountvalue").val(disamount);
                                    $("#subtotal1").text(subtotals);
                                    $("#Subtotal").val(subtotals);
                                    $("#TaxValue").val(taxamount);
                                    $("#TaxValue1").text(taxamount);
                                    $("#Grandtotal").val(total);
                                    $("#Grandtotal1").text(total);
                                }
                                else {
                                    $("#discountvalue").val("");
                                    $("#docdiscountvalue1").text("");
                                    $("#subtotal1").text("");
                                    $("#Subtotal").val("");
                                    $("#TaxValue1").text("");
                                    $("#TaxValue").val("");
                                    $("#Grandtotal").val("");
                                    $("#Grandtotal1").text("");
                                    $("#Price").val("");
                                }

                            });
                        }
                    });
                }
                else {
                    $("#docdiscountvalue1").text("");
                    $("#discountvalue").val("");
                    $("#productname").text("");
                    $("#productcode").text("");
                    $("#Price1").text("");
                    $("#Price").val("");
                    $("#uomtype").text("");
                    $("#taxper").text("");
                    $("#subtotal1").text("");
                    $("#Subtotal").val("");
                    $("#TaxValue1").text("");
                    $("#TaxValue").val("");
                    $("#Grandtotal").val("");
                    $("#Grandtotal1").text("");

                }

            });

            $("#BuyerName").change(function () {
                var buyerid = $('#BuyerName').val();
                $.ajax({
                    url: '/SalesOrder/Getcustomeraddress',
                    type: "GET",
                    dataType: "JSON",
                    data: { id: buyerid },
                    success: function (data) {
                        $(".alert-danger").hide();
                        if (data && data.Add1) {
                            var addressParts = data.Add1.split(",");

                            var addr1 = addressParts[0] ? addressParts[0].trim() : "";
                            var addr2 = addressParts[1] ? addressParts[1].trim() : "";
                            var addr3 = addressParts[2] ? addressParts[2].trim() : "";
                            var addr4 = addressParts[3] ? addressParts[3].trim() : "";

                            $("#libilingadd1").html(addr1);
                            $("#libilingadd2").html(addr2);
                            $("#libilingadd3").html(addr3);
                            $("#libilingadd4").html(addr4);

                            var addressParts1 = data.Add2.split(",");

                            var addr1 = addressParts1[0] ? addressParts1[0].trim() : "";
                            var addr2 = addressParts1[1] ? addressParts1[1].trim() : "";
                            var addr3 = addressParts1[2] ? addressParts1[2].trim() : "";
                            var addr4 = addressParts1[3] ? addressParts1[3].trim() : "";

                            $("#libilingad1").html(addr1);
                            $("#libilingad2").html(addr2);
                            $("#libilingad3").html(addr3);
                            $("#libilingad4").html(addr4);
                        }
                    },
                });
            });
        });
    </script>
    <script>
        function Save() {
            var quantity = $("#quantity").val();
            var ProductID = $("#ProductName").val();
            var buyerid = $("#BuyerName").val();
            $(".alert-danger").hide();
            if (quantity != "" && ProductID != "") {
                if (buyerid != "") {
                    var buyerid = $("#BuyerName").val();
                    var ProductID = $("#ProductName").val();
                    var quantity = $("#quantity").val();
                    var discountperid = $("#discountperid").val();
                    var Specialinstruction = $("#Specialinstruction").val();
                    var Additionalcommends = $("#Additionalcommends").val();

                    var formdata = new FormData();
                    formdata.append("buyerid", buyerid);
                    formdata.append("ProductID", ProductID);
                    formdata.append("quantity", quantity);
                    formdata.append("discountperid", discountperid);
                    formdata.append("Specialinstruction", Specialinstruction);
                    formdata.append("Additionalcommends", Additionalcommends);

                    $.ajax({
                        type: 'POST',
                        url: '/SalesOrder/SalesorderDetails',
                        contentType: false,
                        processData: false,
                        dataType: 'html',
                        data: formdata,
                        success: function (data) {


                            Swal.fire({
                                title: 'Success!!',
                                text: 'Saved Successfully !',
                                icon: 'success',
                                timer: 1000,
                                timerProgressBar: true,
                                showConfirmButton: false
                            });
                            setTimeout(function () {

                                location.href = "/SalesOrder/SalesOrderMaster";
                                return false;
                            }, 1000);

                        }

                    });
                }
                else {
                    $("#alert").append(
                        '<div class="alert alert-danger">' +
                        '<strong>Alert!</strong> Buyer not selected ' +
                        '<strong id="close">x</strong>' +
                        '</div>'
                    );
                    $(document).on('click', '#close', function () {
                        $(".alert-danger").hide();
                    });
                }
            }
            else {
                $("#alert").append(
                    '<div class="alert alert-danger">' +
                    '<strong>Alert!</strong> Purchase item not selected ' +
                    '<strong id="close">x</strong>' +
                    '</div>'
                );
                $(document).on('click', '#close', function () {
                    $(".alert-danger").hide();
                });

            }

        }
    </script>

    <script>
        $(window).on("load", function () {
            $(".report-inner-section").addClass("transection");
            $("#order").attr('checked', true);
            $("#add").attr('checked', true);
        });

        $(document).ready(function () {

            $("#ProductName").change(function () {
                var buyerid = $("#BuyerName").val();
                var ProductName = $("#ProductName").val();

                if ((ProductName != "") && (buyerid != "")) {
                    var buyerid = $("#BuyerName").val();
                    var ProductName = $("#ProductName").val();

                    $.ajax({
                        type: 'GET',
                        url: '/SalesOrder/Alreadychoosenproduct',
                        data: { Buyerid: buyerid, productName: ProductName },
                        dataType: 'json',
                        success: function (data) {
                            if (data == 1) {
                                alert("All ready product added ");
                            }
                        }
                    });
                }
            });

        });
    </script>
</body>

</html>