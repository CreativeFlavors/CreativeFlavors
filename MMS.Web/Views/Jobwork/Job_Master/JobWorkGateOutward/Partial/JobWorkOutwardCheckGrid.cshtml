@model List<MMS.Data.StoredProcedureModel.OutwardGateEntryCheck>

@{
    <link href="~/Content/chosen/bootstrap-chosen.css" rel="stylesheet" />
    <script src="~/Scripts/chosen/chosen.jquery.js"></script>
}

<style>
    .inputgroupes
    {
        display: flex;
    }

    .inputgroupes .form-group
    {
    margin-right: 15px;
    display: flex;
    flex-direction: column;
}

    .inputgroupes .chosen-container
    {
        width: 100%!important;
    }
</style>
<script>
    $(".chosen-select").chosen();
</script>

<div class="veh-tablecont">
    <div class="header_list_tab  col-lg-12 col-md-12 col-sm-12  col-xs-12">
            <div class="col-lg-12 col-md-12 col-sm-12 col-12 no-padding">
                @*<div class="list_tab">
                    <div class="title">
                        List
                    </div>
                                    
                </div>*@
            </div>

        
            <div class="col-lg-6 col-md-12 col-sm-12  col-xs-12">
                <div class="button_tab  col-lg-12 col-md-12 col-sm-12 col-12 no-padding">
                </div>
            </div>
        </div>

    <div class="col-lg-12 input-blk inputgroupes" >
        <div class="form-group">
            <label>Issue Slip No </label>
            @Html.DropDownList("issueslipId", MMS.Web.ExtensionMethod.HtmlHelper.IssueNo_ID_jOB(), new { @class = "form-control input chosen-select" })
        </div>
        <div class="form-group">
            <label>Gate Entry No</label>
            <input type="text" id="GateEntryNo" value="@ViewBag.GateOutNo" class="form-control text-field">
            @*@Html.TextBoxFor(m => m.GateEntryNo, new { @class = "form-control text-field", @readonly = "true" })*@
        </div>
        <div class="form-group">
            <label>Date time</label>
            <input type="text" id="Datetime" value="" class="form-control text-field">
       </div>
    </div>

    <div class="process_master col-lg-12 col-md-12 col-sm-12 col-xs-12">
        <div class="col-xs-12 block-section">
            <div id="no-more-tables" class="col-xs-12 no-padding hole_table">
                <table id="table_grid_sequence" class="col-md-12 table-striped table-condensed cf table-change home_dahboard color_table">
                    <thead>
                        <tr>
                            <td>Save</td>
                            <td>Issue Slip No</td>
                            <td>NoofSets</td>
                            <td>Group</td>
                            <td>Category</td>
                            <td>StoresName</td>
                            <td>Material</td>
                            <td>Color</td>
                            <td>Reqd qty</td>
                            <td>Alreday issued</td>
                            <td>Current Issue</td>
                            <td>Balance Issue</td>
                            <td>Sheet</td>
                            <td>Rate</td>
                        </tr>
                    </thead>
                    <tbody class="common-table-head" id="searchGateOutward">



                        @*@foreach (var Jobsheet in Model)
                        {

                            <tr id="@Jobsheet.IssueSlipNo">
                                <td data-title="Action">
                                    <span class="action-icons">

                                        <a><img onclick="EditClick('@Jobsheet.IssueSlipNo')" class="use-address" src="~/Scripts/Jobwork/images/edit.png"></a>
                                        <img onclick="Delete_Grid('@Jobsheet.IssueSlipNo')" class="use-address" src="~/Scripts/Jobwork/images/delete.png">
                                    </span>
                                </td>
                                <td data-title="OperationType Code">@Jobsheet.IssueSlipNo</td>
                                <td data-title="OperationType Code">@Jobsheet.TotalQty</td>
                                <td data-title="OperationType Code">@Jobsheet.GroupId</td>
                                <td data-title="OperationType Code">@Jobsheet.CategoryId</td>
                                <td data-title="OperationType Code">@Jobsheet.StoreName</td>
                                <td data-title="OperationType Code">@Jobsheet.MaterialName</td>
                                <td data-title="OperationType Code">@Jobsheet.ColourId</td>
                                <td data-title="OperationType Code">@Jobsheet.RequiredQty</td>
                                <td data-title="OperationType Code">@Jobsheet.AlredayIssued</td>
                                <td data-title="OperationType Code">@Jobsheet.CurrentIssue</td>
                                <td data-title="OperationType Code">@Jobsheet.BalanceInThisListlot</td>
                                <td data-title="OperationType Code">@Jobsheet.sheet</td>
                                <td data-title="OperationType Code">@Jobsheet.Rate</td>


                            </tr>
                            //  count++;
                        }*@


                    </tbody>
                </table>
            </div>
        </div>

    </div>
</div>

<div id="EditColorPartial">
    @*@Html.Partial("Partial/OperationMasterDetails", Model)*@
</div>


<script src="~/Scripts/Jobwork/js/datepicker.min.js"></script>
<script src="~/Scripts/Jobwork/js/custom_script.js"></script>
<script src="~/Scripts/moment.js"></script>

<script>

    //$("#search").keyup(function () {
    //    var trHTML = "";
    //    var searchText = $('#search').val();
    //    $.ajax({
    //        method: "POST",
    //        url: '/JobWorkOutward/JobWorkOutwardGridSearch',
    //        data: { IssueSlipNo: searchText },
    //        contentType: 'application/json',
    //        dataType: 'json',
    //        success: function (result) {
    //            debugger;
    //            $.each(result, function (i, item) {

    //                trHTML += '<tr id='+item.IssueSlipNo+'><td data-title="Action"><span class="action-icons"><a><img onclick="EditClick('+item.IssueSlipNo+')" class="use-address" src="/Scripts/Jobwork/images/edit.png"></a></span></td>\
    //                            <td data-title="OperationType Code">' + item.IssueSlipNo + '</td>\
    //                            <td data-title="OperationType Code">'+item.TotalQty+'</td>\
    //                            <td data-title="OperationType Code">'+item.GroupId+'</td>\
    //                            <td data-title="OperationType Code">'+item.CategoryId+'</td>\
    //                            <td data-title="OperationType Code">'+item.StoreName+'</td>\
    //                            <td data-title="OperationType Code">'+item.MaterialName+'</td>\
    //                            <td data-title="OperationType Code">'+item.ColourId+'</td>\
    //                            <td data-title="OperationType Code">'+item.RequiredQty+'</td>\
    //                            <td data-title="OperationType Code">'+item.AlredayIssued+'</td>\
    //                            <td data-title="OperationType Code">'+item.CurrentIssue+'</td>\
    //                            <td data-title="OperationType Code">'+item.BalanceInThisListlot+'</td>\
    //                            <td data-title="OperationType Code">'+item.sheet+'</td>\
    //                            <td data-title="OperationType Code">' + item.Rate + '</td></tr>';


    //            });
    //            $('#searchGateOutward').html(trHTML);
    //            //success(result);
    //        },
    //        complete: function () {
    //            $("#Loader").css("display", "none");
    //        }
    //    });
    //});

    $('#issueslipId').change(function () {        
        var trHTML = "";
        var searchText = $('#issueslipId :selected').text();
        $("#Datetime").val("");
        $.ajax({
            method: "POST",
            url: '/JobWorkOutward/JobWorkOutwardGridSearch',
            data: { IssueSlipNo: searchText },
            contentType: 'application/json',
            dataType: 'json',
            success: function (result) {
                debugger;
                $("#GateEntryNo").val(result.Issue.GateOut_No);
                if ($("#GateEntryNo").val() == "") {
                    $("#GateEntryNo").val(result.GateEntryNo);
                }
                else {
                    $("#Datetime").val(moment(result.Issue.GateOut_No_Datetime));
                }
                $.each(result.gateEntryOutwardCheckList, function (i, item) {

                    trHTML += '<tr id=' + item.IssueSlipNo + '><td data-title="Action"><input type="checkbox" onclick="EditClick(this,' + item.IssueSlipId + ')" class="width-20" id="IsChecked" /></td>\
                                <td data-title="OperationType Code">' + item.IssueSlipNo + '</td>\
                                <td data-title="OperationType Code">'+ item.TotalQty + '</td>\
                                <td data-title="OperationType Code">'+ item.GroupId + '</td>\
                                <td data-title="OperationType Code">'+ item.CategoryId + '</td>\
                                <td data-title="OperationType Code">'+ item.StoreName + '</td>\
                                <td data-title="OperationType Code">' + item.MaterialName + '<br\>' + item.sizerange + '</td>\
                                <td data-title="OperationType Code">'+ item.ColourId + '</td>\
                                <td data-title="OperationType Code">'+ item.RequiredQty + '</td>\
                                <td data-title="OperationType Code">'+ item.AlredayIssued + '</td>\
                                <td data-title="OperationType Code">'+ item.CurrentIssue + '</td>\
                                <td data-title="OperationType Code">'+ item.BalanceInThisListlot + '</td>\
                                <td data-title="OperationType Code">'+ item.sheet + '</td>\
                                <td data-title="OperationType Code">' + item.Rate + '</td></tr>';


                });
                $('#searchGateOutward').html(trHTML);
                //success(result);
            },
            complete: function () {
                $("#Loader").css("display", "none");
            }
        });
    });


    function EditClick (obj,issueSlipId) {
        var isGatechecked=false;

        if ($(obj).is(':checked')) {
            isGatechecked=true;
        }
        else
        {
            isGatechecked=false;
        }
            $.ajax({
                method: "POST",
                url: '/JobWorkOutward/JobWorkOutwardChecked',
                data: { IssueSlipId: issueSlipId, isGatechecked: isGatechecked, GateEntryNo: $("#GateEntryNo").val() },
                contentType: 'application/json',
                dataType: 'json',
                success: function (result) {
                    location.href = "/JobWorkOutward/JobWorkOutward";
                },
                complete: function () {
                    $("#Loader").css("display", "none");
                }
            });
    }

</script>
