@{
    ViewBag.Title = "ConsumptionStatement";
}

<link type="text/css" href="~/Content/css/jquery-ui-1.8.19.custom.css" rel="stylesheet" />
<script type="text/javascript" src="~/Content/themes/base/jquery-1.7.2.min.js"></script>
<script type="text/javascript" src="~/Content/themes/base/jquery-ui-1.8.19.custom.min.js"></script>
<script src="~/Scripts/EasyAutocomplete-1.3.5/AutoComplete%20v1.10.2.js"></script>
<script src="~/Scripts/EasyAutocomplete-1.3.5/AutoComplete%20v1.11.4.js"></script>
<script src="~/Scripts/AutoCompleteCommon.js"></script>

<div>
    <div class="loader-overlay" style="position:fixed;left:0;right:0;top:0;bottom:0;margin:auto;width:100%;height:100%;background:rgba(0,0,0,0.8);z-index:99;">
        <div id="spinner" style="position:relative;height:64px;width:64px;margin:auto;top:50%;">
            <img src="~/Content/Images/round.gif" id="imgLoading" alt="Loading..." />
        </div>
    </div>
    <div class="field-section indent_field">
        <div class="form-group">
            <div class="col-md-5 col-sm-5 col-lg-5 col-xs-12">
                <label for="text" class="form-label">Buyer :</label>
            </div>
            <div class="col-md-7 col-sm-7 col-lg-7 col-xs-12 space_status">
                @Html.DropDownList("Buyer", MMS.Web.ExtensionMethod.HtmlHelper.BuyerName(), new { @class = "select-style text-field" })
            </div>
            <div class="col-md-5 col-sm-5 col-lg-5 col-xs-12">
                <label for="text" class="form-label">From Date :</label>
            </div>
            <div class="col-md-7 col-sm-7 col-lg-7 col-xs-12 space_status">
                <input id="PeriodFrom" name="PeriodFrom" type="text" class="form-control text-field" />
            </div>
            <div class="col-md-5 col-sm-5 col-lg-5 col-xs-12">
                <label for="text" class="form-label">To Date :</label>
            </div>
            <div class="col-md-7 col-sm-7 col-lg-7 col-xs-12 space_status">

                <input id="PeriodTo" name="PeriodTo" type="text" class="form-control text-field" />
            </div>
            <div class="col-md-5 col-sm-5 col-lg-5 col-xs-12">
                <label for="text" class="form-label">Store :</label>
            </div>
            <div class="col-md-7 col-sm-7 col-lg-7 col-xs-12 space_status">
                @Html.DropDownList("StoreNo", MMS.Web.ExtensionMethod.HtmlHelper.Store(), new { @class = "select-style text-field" })
            </div>
            <div class="col-md-5 col-sm-5 col-lg-5 col-xs-12">
                <label for="text" class="form-label">Category :</label>
            </div>
            <div class="col-md-7 col-sm-7 col-lg-7 col-xs-12 primary_report">
                @Html.DropDownList("Category", MMS.Web.ExtensionMethod.HtmlHelper.MaterialCategoryName(), new { @class = "select-style text-field" })
            </div>
            <div class="col-md-5 col-sm-5 col-lg-5 col-xs-12">
                <label for="text" class="form-label">Group :</label>
            </div>
            <div class="col-md-7 col-sm-7 col-lg-7 col-xs-12 space_status">
                @Html.DropDownList("Group", MMS.Web.ExtensionMethod.HtmlHelper.MaterialGroupName(), new { @class = "select-style text-field" })
            </div>
            <div class="col-md-5 col-sm-5 col-lg-5 col-xs-12">
                <label for="text" class="form-label">Lot  No </label>
            </div>
            <div class="col-md-7 col-sm-7 col-lg-7 col-xs-12 space_status">
                @Html.DropDownList("LotNo", MMS.Web.ExtensionMethod.HtmlHelper.LOtNo(), new { @class = "select-style text-field" })
            </div>
            <div class="col-md-5 col-sm-5 col-lg-5 col-xs-12">
                <label for="text" class="form-label">Season :</label>
            </div>
            <div class="col-md-7 col-sm-7 col-lg-7 col-xs-12 space_status">
                @Html.DropDownList("Season", MMS.Web.ExtensionMethod.HtmlHelper.SeasonName(), new { @class = "select-style text-field" })
            </div>
            <div class="col-md-5 col-sm-5 col-lg-5 col-xs-12">
                <label for="text" class="form-label">Bom NO  : </label>
            </div>
            <div class="col-md-7 col-sm-7 col-lg-7 col-xs-12" width="100%">
                @*@Html.DropDownList("BomNo", Model.bomStyleList, "Please Select", new { @class = "select-style text-field " })*@
                @Html.ListBox("Style", new MultiSelectList(MMS.Web.ExtensionMethod.HtmlHelper.BomStyle(), "value",
                          "text"), new { Multiple = "multiple", @class = "multipleOrder_" })
            </div>
            <div class="col-md-5 col-sm-5 col-lg-5 col-xs-12">
                <label for="text" class="form-label">IO No</label>
            </div>
            <div class="col-md-7 col-sm-7 col-lg-7 col-xs-12">
                @Html.TextBox("IoNo")
            </div>
            <div class="col-md-5 col-sm-5 col-lg-5 col-xs-12">
                <label for="text" class="form-label">Material Type</label>
            </div>
            <div class="col-md-7 col-sm-7 col-lg-7 col-xs-12">
                @Html.DropDownList("MaterialType", new SelectList(
                new List<object> {
                                            new { value="", text="Please select" },
                                           new { value=1, text="Local" },
                                           new { value=2, text="Customer Import"},
                                            new { value=3, text="Direct Import"}
                },
                "value",
                "text", ""), new { @class = "select-style text-field" })
            </div>


            <div class="col-md-5 col-sm-5 col-lg-5 col-xs-12">
                <label for="text" class="form-label">Conveyor </label>
            </div>
            <div class="col-md-7 col-sm-7 col-lg-7 col-xs-12">
                @Html.DropDownList("Conveyor", MMS.Web.ExtensionMethod.HtmlHelper.Conveyor(), new { @class = "select-style text-field" })
            </div>
        </div>
    </div>
    <input id="ExportReport" class="indent_report_field" name="ExportReport" type="submit" value="Generate Report" />
</div>
<link href="~/Scripts/MultiSelectCheckBoxWithSearch/fSelect.css" rel="stylesheet" />
<script src="~/Scripts/MultiSelectCheckBoxWithSearch/Jquery.min.js"></script>
<script src="~/Scripts/MultiSelectCheckBoxWithSearch/fSelect.js"></script>

<script>
    (function ($) {
        $(function () {
            $('.multipleOrder_').fSelect();
        });
    })(jQuery);
    $(document).ready(function () {
        $(document).ajaxStart(function () {
            $(".loader-overlay").css("display", "block");
        });

        $(document).ajaxComplete(function () {
            $(".loader-overlay").css("display", "none");
        });
        $(window).load(function () {
            $('.loader-overlay').fadeOut('fast');
        });
        $("#PeriodFrom").datepicker({ dateFormat: "dd/mm/yy" });
        $("#PeriodTo").datepicker({ dateFormat: "dd/mm/yy" });

        $("#StoreNo").change(function () {

            var StoreId = $('#StoreNo').val();
            $.ajax({
                url: '/MaterialMaster/FillMaterialCateogoryid',
                type: "GET",
                dataType: "JSON",
                data: { StoreMasterId: StoreId },
                success: function (cities) {

                    $("#Category").html(""); // clear before appending new list
                    $('#Category').append('<option value="0" selected="selected">Please Select</option>');
                    $.each(cities, function (i, city) {
                        $("#Category").append(
                            $('<option></option>').val(city.MaterialCategoryMasterId).html(city.CategoryName));
                    });
                }
            });
        });
        $("#Category").change(function () {
            var MaterialCategoryMasterId_ = $('#Category').val();
            $.ajax({
                url: '/MaterialMaster/FillCateogoryid',
                type: "GET",
                dataType: "JSON",
                data: { MaterialCategoryMasterId: MaterialCategoryMasterId_ },
                success: function (cities) {
                    $("#Group").html("");
                    $('#Group').append('<option value="" selected="selected">Please Select</option>');
                    $.each(cities, function (i, city) {
                        $("#Group").append(
                            $('<option></option>').val(city.MaterialGroupMasterId).html(city.GroupName));
                    });
                }
            });

        });

        $("#ExportReport").click(function (event) {
            if ($('#PeriodFrom').val() == "") {
                alert("Please select Period From.")
                $('#PeriodFrom').css('border-color', 'red');
                $('#PeriodFrom').focus();
                return false;
            }
            else {
                $('#PeriodFrom').css('border-color', '');
            }
            if ($('#PeriodTo').val() == "") {
                alert("Please select Period To.")
                $('#PeriodTo').css('border-color', 'red');
                $('#PeriodTo').focus();
                return false;
            }
            else {
                $('#PeriodTo').css('border-color', '');
            }

            if ($('#StoreNo').val() == "") {
                alert("Please select Store.")
                $('#StoreNo').css('border-color', 'red');
                $('#StoreNo').focus();
                return false;
            }
            else {
                $('#StoreNo').css('border-color', '');
            }

            if ($('#Buyer').val() == "") {
                alert("Please select Buyer.")
                $('#Buyer').css('border-color', 'red');
                $('#Buyer').focus();
                return false;
            }
            else {
                $('#Buyer').css('border-color', '');
            }
            var From = $("#PeriodFrom").val();
            var To = $("#PeriodTo").val();
            var Group = $('#Group').val();
            var StoreNo = $("#StoreNo").val();
            var Category = $("#Category").val();
            var Buyer = $("#Buyer").val();
            var IoNo = $("#IoNo").val();
            var LotNo = $('#LotNo option:selected').text();
            if (LotNo.toLowerCase() == "please select") {
                LotNo = "";
            }
            var Conveyor = $("#Conveyor").val();
            var Season = $("#Season").val();
            var MaterialType = $("#MaterialType").val();
            var Style = $("#Style").val();

            if (Style != null) {
                Style = Style.join();
            }
            else {
                Style = "";
            }


            event.preventDefault();
            $.ajax({
                type: 'POST',
                url: '/ConsumptionStatement/RedirectToAspx',
                data: {
                    group: Group,
                    storeNo: StoreNo,
                    from: From,
                    to: To,
                    category: Category,
                    buyer: Buyer,
                    ioNo: IoNo,
                    lotNo: LotNo,
                    conveyor: Conveyor,
                    season: Season,
                    materialType: MaterialType,
                    style: Style
                },
                success: function (data) {
                    var url = "@(System.Configuration.ConfigurationManager.AppSettings["ReportURL"].ToString())ConsumptionStatement.aspx?FromDate=" + data.FromDate + "&ToDate=" + data.ToDate + "&Group=" + data.Group + "&StoreNo=" + data.StoreNo + "&Category=" + data.Category + "&Buyer=" + data.Buyer + "&IoNo=" + data.IoNo + "&Conveyor=" + data.Conveyor + "&Season=" + data.Season + "&MaterialType=" + data.MaterialType + "&Style=" + data.Style + "&LotNo=" + data.LotNo;
                    window.open(url, '_blank');
                    return false
                }
            });
        });
    })

</script>
