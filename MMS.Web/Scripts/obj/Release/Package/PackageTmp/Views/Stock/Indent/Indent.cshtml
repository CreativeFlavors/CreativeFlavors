@{
    ViewBag.Title = "Indent";
    Layout = "~/Views/Shared/_Layout.cshtml";

    <link href="~/Content/css/bootstrap.min.css" rel="stylesheet" />
    <link href="~/Content/css/FormStyle.css" rel="stylesheet" />

}
<style>

</style>
<h2 class="content-title">Indent</h2>
<div style="width: 100%; float: left;">

    <div id="tabVehicleWatchList">
        @Html.Action("IndentGrid", "Indent")
    </div>
</div>

<script>
    $(document).ready(function () {
        $("#EditColorPartial").hide();
    });

    function validation() {
        if ($('#AmmendmentDate').val() == "") {
            alert("Please Enter Ammendment Date.")
            $('#AmmendmentDate').css('border-color', 'red');
            $('#AmmendmentDate').focus();
            return false;
        }
        else {
            $('#AmmendmentDate').css('border-color', '');
        }
        if ($('#IndentType').val() == "") {
            alert("Please Select Indent Type.")
            $('#IndentType').css('border-color', 'red');
            $('#IndentType').focus();
            return false;
        }
        else {
            $('#IndentType').css('border-color', '');
        }
        if ($('#IndentNo').val() == "") {
            alert("Please Enter Indent No.")
            $('#IndentNo').css('border-color', 'red');
            $('#IndentNo').focus();
            return false;
        }
        else {
            $('#IndentNo').css('border-color', '');
        }
        if ($('#Indendingfor option:selected').text() == "ORDER") {
            if ($('#IoNo').val() == "") {
                alert("Please Enter Io No.")
                $('#IoNo').css('border-color', 'red');
                $('#IoNo').focus();
                return false;
            }
            else {
                $('#IoNo').css('border-color', '');
            }
        }
        if ($("#UnitId :selected").val() == "") {
            alert("Please Select UnitId.")
            $('#UnitId').css('border-color', 'red');
            $('#UnitId').focus();
            return false;
        }
        else {
            $('#UnitId').css('border-color', '');
        }

        if ($('#Indendingfor').val() == "") {
            alert("Please Enter Indent For.")
            $('#Indendingfor').css('border-color', 'red');
            $('#Indendingfor').focus();
            return false;
        }
        else {
            $('#Indendingfor').css('border-color', '');
        }

       

        if ($('#Date').val() == "") {
            alert("Please Select Date.")
            $('#Date').css('border-color', 'red');
            $('#Date').focus();
            return false;
        }
        else {
            $('#Date').css('border-color', '');
        }
        if ($('#MRPNO').val() == "" || $('#MRPNO').val() == 0)
        {
            if ($('#MaterialCatId').val() == "") {
                alert("Please Select Material Category.")
                $('#MaterialCatId').css('border-color', 'red');
                $('#MaterialCatId').focus();
                return false;
            }
            else {
                $('#MaterialCatId').css('border-color', '');
            }
            if ($('#SeasonId').val() == "") {
                alert("Please Select Season.")
                $('#SeasonId').css('border-color', 'red');
                $('#SeasonId').focus();
                return false;
            }
            else {
                $('#SeasonId').css('border-color', '');
            }

            if ($('#MaterialGrpId').val() == "") {
                alert("Please Select Material Group.")
                $('#MaterialGrpId').css('border-color', 'red');
                $('#MaterialGrpId').focus();
                return false;
            }
            else {
                $('#MaterialGrpId').css('border-color', '');
            }

            if ($('#MaterialName').val() == '0') {
                alert("Please select material name.")
                $('#MaterialName').css('border-color', 'red');
                $('#MaterialName').focus();
                return false;
            }
            else {
                $('#MaterialName').css('border-color', '');
            }

            if ($('#UOMId').val() == "") {
                alert("Please Select UOM.")
                $('#UOMId').css('border-color', 'red');
                $('#UOMId').focus();
                return false;
            }
            else {
                $('#UOMId').css('border-color', '');
            }

            if ($('#ReqQty').val() == "") {
                alert("Please Enter Required Qty.")
                $('#ReqQty').css('border-color', 'red');
                $('#ReqQty').focus();
                return false;
            }
            else {
                $('#ReqQty').css('border-color', '');
            }

            if ($('#StoreStock').val() == "") {
                alert("Please Enter Store Stock.")
                $('#StoreStock').css('border-color', 'red');
                $('#StoreStock').focus();
                return false;
            }
            else {
                $('#StoreStock').css('border-color', '');
            }

            if ($('#MaterialId').val() == "") {
                alert("Please Select Material.")
                $('#MaterialId').css('border-color', 'red');
                $('#MaterialId').focus();
                return false;
            }
            else {
                $('#MaterialId').css('border-color', '');
            }

            if ($('#Rate').val() == "") {
                alert("Please Enter Rate.")
                $('#Rate').css('border-color', 'red');
                $('#Rate').focus();
                return false;
            }
            else {
                $('#Rate').css('border-color', '');
            }

            if ($('#IntendQty').val() == "") {
                alert("Please Enter Intend Qty.")
                $('#IntendQty').css('border-color', 'red');
                $('#IntendQty').focus();
                return false;
            }
            else {
                $('#IntendQty').css('border-color', '');
            }

            if ($('#FreeStock').val() == "") {
                alert("Please Enter Free Stock.")
                $('#FreeStock').css('border-color', 'red');
                $('#FreeStock').focus();
                return false;
            }
            else {
                $('#FreeStock').css('border-color', '');
            }

            if ($('#ColourId').val() == "") {
                alert("Please Select Colour.")
                $('#ColourId').css('border-color', 'red');
                $('#ColourId').focus();
                return false;
            }
            else {
                $('#ColourId').css('border-color', '');
            }

            if ($('#Value').val() == "") {
                alert("Please Enter Value.")
                $('#Value').css('border-color', 'red');
                $('#Value').focus();
                return false;
            }
            else {
                $('#Value').css('border-color', '');
            }
        }
       

        //if ($('#SupplierId').val() == "") {
        //    alert("Please Select Supplier Name.")
        //    $('#SupplierId').css('border-color', 'red');
        //    $('#SupplierId').focus();
        //    return false;
        //}
        //else {
        //    $('#SupplierId').css('border-color', '');
        //}

        //if ($('#Remarks').val() == "") {
        //    alert("Please Enter Remarks.")
        //    $('#Remarks').css('border-color', 'red');
        //    $('#Remarks').focus();
        //    return false;
        //}
        //else {
        //    $('#Remarks').css('border-color', '');
        //}
    }
    function Save() {
        



        //if ($('#SelectedIndentNO option:selected').val() == undefined || $('#SelectedIndentNO option:selected').val() == "") {
        //    alert("Please Select IndentNO.")
        //    $('#SelectedIndentNO').css('border-color', 'red');
        //    $('#SelectedIndentNO').focus();
        //    return false;
        //}
        //else {
        //    $('#SelectedIndentNO').css('border-color', '');
        //}

        //var AddSelectedIoNo = "";

        //var selectedValues = $.map($('#SelectedIndentNO option:selected'), function (element) {

        //    AddSelectedIoNo = AddSelectedIoNo + element.value + ",";

        //});

        //var SelectedIndentNO1 = $('#SelectedIndentNO').val();
        //if (SelectedIndentNO1 == null) {
        //    SelectedIndentNO1 ="";
        //}
        //SelectedIndentNO1 = SelectedIndentNO1.toString();

        //$('#form').submit(function () {

        //    $("#form :disabled").removeAttr('disabled');

        //});

        // $("#list-amended-material tbody tr").each(function () {

        //var IoNo = $(this).find('.IoNo').text();
        //var MaterialName = $(this).find('.MaterialName').text();
        //var ColourId = $(this).find('.ColourId').text();
        //var UOMId = $(this).find('.UOMId').text();
        //var IntendQty = $(this).find('.IntendQty').text();
        //var Date = $(this).find('.Date').text();
        //var MaterialCatId = $(this).find('.MaterialCatId').text();
        //var MaterialGrpId = $(this).find('.MaterialGrpId').text();
        //var ReqQty = $(this).find('.ReqQty').text();
        //var SupplierId = $(this).find('.SupplierId').text();
        //var Remarks = $(this).find('.Remarks').text();

        //var IndentId = $(this).find('.IndentId').text();
        //var IndentType = $(this).find('.IndentType').text();
        //var UnitId = $(this).find('.UnitId').text();
        //var IndentNo = $(this).find('.IndentNo').text();
        //var Indendingfor = $(this).find('.Indendingfor ').text();
        //var SeasonId = $(this).find('.SeasonId').text();
        //var BuyerId = $(this).find('.BuyerId').text();
        //var RequestedBy = $(this).find('.RequestedBy').text();
        //var Rate = $(this).find('.Rate').text();
        //var Value = $(this).find('.Value ').text();
        //var StoreStock = $(this).find('.StoreStock').text();
        //var FreeStock = $(this).find('.FreeStock').text();
        //var PreparedBy = $(this).find('.PreparedBy ').text();
        //var CheckedBy = $(this).find('.CheckedBy').text();
        //var ApprovedBy = $(this).find('.ApprovedBy').text();

        // var formdata = $('form').serialize();

        //if ($("#list-amended-material tbody tr").length == 0) {chnage to below
           
      if($('#MRPNO').val() != "" || $('#MRPNO').val() != 0) {
            validation();
            if (validation() != false) {
               
                var forms_ = $("form").serialize();
                console.log(forms_);
                $.ajax({
                    type: 'POST',
                    url: '/Indent/Indent',
                    data: forms_ ,
                    // contentType: "application/json; charset=utf-8",
                    success: function (data) {
                        if (data == true) {
                            if ($("#BtnSave").val() == "Save") {
                                alert('Saved Successfully.');
                                location.href = "/Indent/Indent";
                                return false;
                                $("#ColourId").attr("disabled", true);
                            }
                            else {
                                alert('Updated Successfully.');
                                location.href = "/Indent/Indent";
                                return false;

                                $("#ColourId").attr("disabled", true);
                            }
                            //  $("#BtnSave").attr('value', 'Save');
                            location.href = "/Indent/Indent";
                            return false;
                        }
                        else {
                            alert('Save process Failed.');
                            location.href = "/Indent/Indent";
                            return false;
                        }

                    }
                });
            }
        }

        else {

            var wholeJsonList = [];
            $('#list-amended-material tbody tr').each(function () {
                wholeJsonList.push(
                    {
                        BOMID:$(this).find('.BOMID').html(),
                        IoNo: $(this).find('.IoNo').html(),
                        AmmendmentDate: $(this).find('.AmmendmentDate').html(),
                        MaterialName: $(this).find('.MaterialName').html(),
                        ColourId: $(this).find('.ColourId').html(),
                        UOMId: $(this).find('.UOMId').html(),
                        IntendQty: $(this).find('.IntendQty').html(),
                        Date: $(this).find('.Date').html(),
                        MaterialCatId: $(this).find('.MaterialCatId').html(),
                        MaterialGrpId: $(this).find('.MaterialGrpId').html(),
                        ReqQty: $(this).find('.ReqQty').html(),
                        SupplierId: $(this).find('.SupplierId').html(),
                        Remarks: $(this).find('.Remarks').html(),

                        IndentId: $(this).find('.IndentId').html(),
                        IndentType: $(this).find('.IndentType').html(),
                        UnitId: $(this).find('.UnitId').html(),
                        IndentNo: $(this).find('.IndentNo').html(),
                        Indendingfor: $(this).find('.Indendingfor').html(),
                        SeasonId: $(this).find('.SeasonId').html(),
                        BuyerId: $(this).find('.BuyerId').html(),
                        RequestedBy: $(this).find('.RequestedBy').html(),
                        Rate: $(this).find('.Rate').html(),
                        Value: $(this).find('.Value ').html(),
                        StoreStock: $(this).find('.StoreStock').html(),
                        FreeStock: $(this).find('.FreeStock').html(),
                        PreparedBy: $(this).find('.PreparedBy ').html(),
                        CheckedBy: $(this).find('.CheckedBy').html(),
                        ApprovedBy: $(this).find('.ApprovedBy').html()
                    });
            });

            var wholeJsonListLength = wholeJsonList.length;
            console.log(wholeJsonListLength);
            var i = 0;
            for (i = 0; i <= wholeJsonListLength - 1; i++) {
                $.ajax({
                    type: 'POST',
                    url: '/Indent/Indent',
                    data: wholeJsonList[i],
                    success: function (data) {
                        if (data == true) {
                            if ($('#BtnSave').val() == "Save") {
                                alert("Saved Successfully.");
                                location.href = "/Indent/Indent";
                                return false;
                            }
                            else {
                                alert('Updated Successfully.');
                                location.href = "/Indent/Indent";
                                return false;
                            }
                            location.href = "/Indent/Indent";
                            return false;
                        }
                        else {
                            alert('Save process Failed.');
                            location.href = "/Indent/Indent";
                            return false;
                        }
                    }
                })
            }
        }
    // });
    }

</script>
